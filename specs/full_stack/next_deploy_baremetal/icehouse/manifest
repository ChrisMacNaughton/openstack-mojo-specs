# Collect the charm branches from Launchpad
collect config=collect-next

# Copy the branches to the deployment directory
repo config=repo-next

# Adjust constraints if UOSCI_MAAS_TAGS env var is set

# read in baremetal7.yaml, write to baremetal7-custom.yaml
script config=scripts/bundle_constrainer.py -yd -i baremetal7.yaml -o baremetal7-custom.yaml --constraints "tags=uosci" -e "ceilometer-agent,cinder-ceph,neutron-openvswitch"

# Use juju deployer with baremetal7.yaml bundle
deploy config=baremetal7-custom.yaml delay=0 target=${MOJO_SERIES}-icehouse

# Check juju statuses are green and that hooks have finished
verify config=check_juju.py

# Create sdn on overcloud
script config=network_setup.py

# Setup glance images
script config=image_setup.py

# Setup keystone users
script config=keystone_setup.py

# Create and check instances on the deployed cloud
verify config=simple_os_checks.py MACHINES='cirros:m1.tiny:1 precise:m1.small:1' CLOUDINIT_WAIT="300"
